# 批量执行使用指引

“批量执行”功能是为了满足在日常运维管理工作中出现的较为随机和零散的运维操作的执行而设计的。用户可以通过四个步骤来完成针对一批特定数据对象的批量运维操作。

## 菜单总览

![image-20240403225920868](./images/taskman/image-20240403225920868.png)

## 新建执行

### 选择模版

选择使用角色,点击模版

![image-20240403225608347](./images/taskman/image-20240403225608347.png)



### 查看操作对象的查询方式

以WeCube数据模型中的数据类型以及它们之间的关系为基础，用户需要定义出操作执行目标类型的查询路径、业务主键、查询条件等，这些是操作对象查询方式的关键要素。

![image-20240403230230174](./images/taskman/image-20240403230230174.png)

其中

*目标类型* 是应于批量操作最终执行时的数据对象类型，系统会自动将查询路径的最后一个类型作为目标类型。

*查询路径* 是由WeCube数据模型中的对象关联所组成的数据链式表达式（请参考 *数据模型表达式DME* 的相关概念）。

*业务主键* 是代表对象的主要标识，用于结果展示。

*查询条件* 可以作为精确指定操作对象范围的过滤条件。由于查询条件可以作用在目标数据类型的属性上，也可以作用在与目标数据类型相关联的其它数据类型上面，因此 *查询路径* 实际上就定义了：

- 用户希望在哪些关联的数据类型和它们的属性上应用查询条件

- 这些关联数据类型之间通过哪种关联关系进行连接并能够最终到达目标数据类型  



### 勾选执行实例

在定义好查询方式之后，即可进行操作对象的查询

支持查询结果模糊搜索
![image-20240403230333224](./images/taskman/image-20240403230333224.png)

WeCube会按照之前定义好的查询方式返回匹配的数据对象列表，以便用户在列表中选择批量操作的执行对象。

### 选择插件并配置参数

在数据对象列表中选择好批量操作的执行对象后，点击 *选择插件* 按钮可以在弹出的对话框中继续配置将要执行的操作和操作的输入参数。

![image-20240403230449608](./images/taskman/image-20240403230449608.png)

在 *插件* 列表中，可以选择一项在WeCube平台中已经注册的插件服务作为将要执行的批量操作，另外，列表中能够选择的插件服务与查询结果的数据类型有关。选择好操作后，对话框中会显示出插件服务对应的输入参数，并且根据WeCube中的插件服务配置提示用户输入本次操作执行中需要的参数值。

### 执行与高危检测

执行之后在执行结果中查看

![image-20240403230522556](./images/taskman/image-20240403230522556.png)

## 执行历史

### 查看和检索执行结果

支持查看所有执行历史记录,执行结果
左侧的列表中显示本次操作执行涉及的操作对象，操作对象将按照之前在查询方式定义中选择的业务主键作为标识来进行显示与区别。每个操作对象的执行结果状态将通过颜色的方式进行区分：

- 红色代表至少一条操作执行失败或发生错误
- 绿色代表全部操作执行顺利完成

![image-20240403225712785](./images/taskman/image-20240403225712785.png)

用户可以通过点击列表中的操作对象，在右侧的操作结果窗口中查看具体的执行结果信息。
另外，如果操作对象过多，可以通过列表上方的输入框对操作对象进行过滤显示，操作对象列表中将只显示与输入关键字相匹配的操作对象。

### 查看单条

展开详细输入输出:

![image-20240403225805630](./images/taskman/image-20240403225805630.png)



## 新建模版

填写模版信息,预执行,只有当预执行成功才能发布模版

![image-20240403230844026](./images/taskman/image-20240403230844026.png)

## 模版管理

选择属主角色,点击模版,支持查看模版、复制模版、修改权限、删除模版

![image-20240403231014891](./images/taskman/image-20240403231014891.png)

权限管理

![image-20240403231228746](./images/taskman/image-20240403231228746.png)
